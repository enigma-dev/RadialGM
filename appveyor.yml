# don't build "feature" branches
skip_branch_with_pr: true
branches:
  # whitelist
  only:
    - master

# Build worker image (VM template)
image: Visual Studio 2017

# fetch repository as zip archive for faster clone
shallow_clone: true
clone_depth: 1

platform:
  - x86
  - x64

for:
- matrix:
    only:
      - platform: x64
      # TODO: change to GitHub releases
      - depsurl: https://ci.appveyor.com/api/buildjobs/xrs6idr9f2grmmy8/artifacts/rgmdeps-x64.zip
  init:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"
- matrix:
    only:
      - platform: x86
      # TODO: change to GitHub releases
      - depsurl: https://ci.appveyor.com/api/buildjobs/uw0lf6xbgwkfp443/artifacts/rgmdeps-x86.zip
  init:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars32.bat"

install:
  - cd C:\tools\vcpkg\installed
  - appveyor DownloadFile $depsurl -FileName vcpkgdeps.zip
  - 7z e -mmt vcpkgdeps.zip -o$(PLATFORM)-windows-static
  - cd %APPVEYOR_BUILD_FOLDER%

build_script:
  - echo Hello Build!

artifacts:
  - path: RadialGM-Win32-$(PLATFORM).zip
    name: RadialGM-Win32-$(PLATFORM)

deploy:
  release: RadialGM-v$(appveyor_build_version)
  provider: GitHub
  auth_token:
    secure: $(bot_push_on_green_token)
  artifact: RadialGM-Win32-$(PLATFORM)
  draft: false
  prerelease: false
  on:
    branch: master
